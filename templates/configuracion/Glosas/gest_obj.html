<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <title>Cloud Medical Fees mySiss</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: white;
    }

    .container {
      display: flex;
    }

    .sidebar {
      width: 180px;
      background-color: #eee6f8;
      padding: 20px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex-grow: 1; 
    }

    .sidebar-footer {
      margin-top: auto;
      margin-bottom: 10px; 
    }
    
    .sidebar a[href="login.html"] {
      position: relative;
      bottom: 30px;
    }

    a[href="login.html"] {
      position: relative;
      bottom: 10px;
    }

    .logout {
      color: purple;
      text-decoration: none;
      font-weight: bold;
    }
    
    .sidebar h1 {
      color: purple;
      font-weight: bold;
      font-size: 50px;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      margin: 20px 0;
      color: purple;
      text-decoration: none;
      font-weight: bold;
    }

    .main {
      margin-left: 240px;
      flex: 1;
      background-color: white;
      padding: 20px 40px;
    }
    
    .radio-group {
      display: flex;  
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .radio-group label {
      display: inline-flex;
      align-items: center;
      margin-right: 30px;
      gap: 0px;
    }

    .form-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    label {
      min-width: 140px;
    }

    input, select {
      padding: 6px;
      width: 200px;
    }

    .btn {
      padding: 8px 16px;
      margin-top: 10px;
      margin-right: 10px;
      background-color: purple;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .table-section {
      background-color: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }

    table th, table td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: left;
    }

    table th {
      background-color: #f0f0f0;
    }
    
    th.col-select, td.col-select {
      width: 20px;
      min-width: 20px;
      max-width: 20px;
      padding: 0;
      text-align: center;
      vertical-align: middle;
      position: relative;
    }

    td.col-select input[type="checkbox"],
    th.col-select input[type="checkbox"] {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      padding: 0;
    }

    h3 {
      font-size: 16px;
      margin-top: 0;
    }
    
    .subrayado {
      text-decoration: underline;
    }
    
    td.col-select {
      position: relative;
      width: 40px;
      padding: 0;
    }

    .btn-icon {
      display: inline-block;
      padding: 8px;
      border-radius: 8px;
      background-color: purple; 
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-left: 40px;
    }

    .btn-icon:hover {
      background-color: #b80bd7;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
        
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
      position: relative;
    }
        
    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
        
    .close:hover {
      color: black;
    }
        
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
        
    .modal-buttons button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
        
    .modal-buttons .accept {
      background-color: purple;
      color: white;
    }
        
    .modal-buttons .cancel {
      background-color: #ddd;
    }

    /* Nuevos estilos para la funcionalidad */
    .search-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }
    
    .search-filters .filter-group {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    
    .search-filters label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    
    .search-filters input, 
    .search-filters select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .search-button {
      align-self: flex-end;
      margin-top: auto;
    }
    
    .user-info {
      background-color: #f0f0f0;
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    
    .invoice-header {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .invoice-card {
      flex: 1;
      min-width: 200px;
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
      border-left: 4px solid purple;
    }
    
    .invoice-card h4 {
      margin: 0 0 5px 0;
      color: purple;
    }
    
    .invoice-card p {
      margin: 0;
      color: #555;
    }
    
    .objections-detail {
      margin-top: 20px;
    }
    
    .objections-detail h3 {
      color: purple;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    
    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 15px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .status-obj {
      background-color: #ffeb3b;
      color: #000;
    }
    
    .status-ora {
      background-color: #ff9800;
      color: #fff;
    }
    
    .status-oco {
      background-color: #4caf50;
      color: #fff;
    }
    
    .status-roa {
      background-color: #2196f3;
      color: #fff;
    }
    
    .tab-container {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    
    .tab.active {
      border-bottom-color: purple;
      font-weight: bold;
      color: purple;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .note-icon {
      color: purple;
      cursor: pointer;
    }
    
    .note-popup {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      padding: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
      max-width: 300px;
      display: none;
    }
    
    .traffic-light {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
    }
    
    .traffic-light.yellow {
      background-color: #ffeb3b;
    }
    
    .traffic-light.green {
      background-color: #4caf50;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="sidebar-content">
        <h1>mySiss</h1>
        <a href="index.html">Radicacion de facturas</a>
        <a href="dev_Fact.html">Devolucion de facturas</a>
        <a href="carg_obj.html">Cargue de objeciones</a>
        <a href="gest_obj.html" style="text-decoration: underline;">Gestion de objeciones</a>
        <a href="conc_obj.html">Conciliacion de objeciones</a>
      </div>
      <a href="../login.html" class="logout">Cerrar sesión</a>
    </div>

    <div class="main">
      <h2>Gestión de Objeciones y Glosas</h2>
      
      <div class="tab-container">
        <div class="tab active" onclick="openTab('contest')">Contestar Objeción</div>
        <div class="tab" onclick="openTab('register')">Registrar Respuesta</div>
        <div class="tab" onclick="openTab('respond')">Responder Objeción</div>
        <div class="tab" onclick="openTab('consult')">Consultar Objeciones</div>
        <div class="tab" onclick="openTab('results')">Resultados</div>
      </div>
      
      <!-- Contestar Objeción -->
      <div id="contest" class="tab-content active">
        <div class="search-filters">
          <div class="filter-group">
            <label for="contest-rad-number">No. Radicado Externo</label>
            <input type="text" id="contest-rad-number">
          </div>
          <div class="filter-group">
            <label for="contest-invoice-number">No. Factura</label>
            <input type="text" id="contest-invoice-number">
          </div>
          <div class="filter-group">
            <label for="contest-objection-date">Fecha Objeción</label>
            <input type="date" id="contest-objection-date">
          </div>
          <div class="filter-group">
            <label for="contest-invoice-status">Estado Factura</label>
            <select id="contest-invoice-status">
              <option value="OBJ">Objetada</option>
            </select>
          </div>
          <button class="btn search-button" onclick="searchContestObjections()">Buscar</button>
        </div>
        
        <div class="user-info">
          <p><strong>Usuario responsable:</strong> JAGUAZAC</p>
          <p><strong>Nombre:</strong> JOHN AGUAZACO</p>
        </div>
        
        <div class="invoice-header">
          <div class="invoice-card">
            <h4>No. Rad Ext</h4>
            <p id="contest-rad-ext">00001</p>
          </div>
          <div class="invoice-card">
            <h4>Factura</h4>
            <p id="contest-invoice">80003922</p>
          </div>
          <div class="invoice-card">
            <h4>Fecha Rad</h4>
            <p id="contest-rad-date">08.01.2025</p>
          </div>
          <div class="invoice-card">
            <h4>Responsable Pago</h4>
            <p id="contest-payer">Asegurador 1</p>
          </div>
          <div class="invoice-card">
            <h4>Estado</h4>
            <p id="contest-status"><span class="status-badge status-obj">Objetada</span></p>
          </div>
          <div class="invoice-card">
            <h4>Valor</h4>
            <p id="contest-value">100.000</p>
          </div>
        </div>
        
        <div class="objections-detail">
          <h3>Detalle objeciones</h3>
          <table>
            <thead>
              <tr>
                <th>Posición</th>
                <th>Servicio</th>
                <th>Descripción Servicio</th>
                <th>Cantidad</th>
                <th>Valor Servicio</th>
                <th>Motivo Objeción</th>
                <th>Valor Objeción</th>
                <th>Valor Prestador</th>
                <th>Nota Objeción</th>
                <th>Responsable</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="contest-objections-table">
              <tr>
                <td>360701</td>
                <td>Com. UJ W. Gramsci</td>
                <td>Consulta Urgencias</td>
                <td>1</td>
                <td>50.000</td>
                <td>No Cubierto</td>
                <td>30.000</td>
                <td><input type="number" value="30.000" class="provider-value"></td>
                <td>
                  <i class="fas fa-search note-icon" onclick="showNotePopup(this, 'Nota de objeción: No cubierto por el plan')"></i>
                </td>
                <td>
                  <select class="responsible-select">
                    <option>JAGUAZAC</option>
                    <option>AMHENAO</option>
                  </select>
                </td>
                <td>
                  <button class="btn" onclick="contestObjection(this)">Contestar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Registrar Respuesta Objeción Aseguradora -->
      <div id="register" class="tab-content">
        <div class="search-filters">
          <div class="filter-group">
            <label for="register-rad-number">No. Radicado Externo</label>
            <input type="text" id="register-rad-number">
          </div>
          <div class="filter-group">
            <label for="register-invoice-number">No. Factura</label>
            <input type="text" id="register-invoice-number">
          </div>
          <div class="filter-group">
            <label for="register-objection-date">Fecha Objeción</label>
            <input type="date" id="register-objection-date">
          </div>
          <div class="filter-group">
            <label for="register-invoice-status">Estado Factura</label>
            <select id="register-invoice-status">
              <option value="OCO">Objeción Contestada</option>
            </select>
          </div>
          <button class="btn search-button" onclick="searchRegisterResponses()">Buscar</button>
        </div>
        
        <div class="user-info">
          <p><strong>Usuario responsable:</strong> JAGUAZAC</p>
          <p><strong>Nombre:</strong> JOHN AGUAZACO</p>
        </div>
        
        <div class="invoice-header">
          <div class="invoice-card">
            <h4>No. Rad Ext</h4>
            <p id="register-rad-ext">00001</p>
          </div>
          <div class="invoice-card">
            <h4>Factura</h4>
            <p id="register-invoice">80003922</p>
          </div>
          <div class="invoice-card">
            <h4>Fecha Rad</h4>
            <p id="register-rad-date">08.01.2025</p>
          </div>
          <div class="invoice-card">
            <h4>Responsable Pago</h4>
            <p id="register-payer">Asegurador 1</p>
          </div>
          <div class="invoice-card">
            <h4>Estado</h4>
            <p id="register-status"><span class="status-badge status-oco">Contestada</span></p>
          </div>
          <div class="invoice-card">
            <h4>Valor</h4>
            <p id="register-value">100.000</p>
          </div>
        </div>
        
        <div class="objections-detail">
          <h3>Detalle objeciones</h3>
          <table>
            <thead>
              <tr>
                <th>Posición</th>
                <th>Servicio</th>
                <th>Descripción</th>
                <th>Valor Servicio</th>
                <th>Valor Pagador</th>
                <th>Valor no objetado</th>
                <th>Motivo Objeción</th>
                <th>Valor Prestador</th>
                <th>Nota Pagador</th>
                <th>Valor Asegurador</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="register-objections-table">
              <tr>
                <td>360701</td>
                <td>Com. UJ W. Gramsci</td>
                <td>Consulta Urgencias</td>
                <td>50.000</td>
                <td>30.000</td>
                <td>20.000</td>
                <td>No Cubierto</td>
                <td>30.000</td>
                <td>
                  <i class="fas fa-search note-icon" onclick="showNotePopup(this, 'Nota del pagador: Aceptamos parcialmente')"></i>
                </td>
                <td><input type="number" value="25.000" class="insurer-value"></td>
                <td>
                  <button class="btn" onclick="registerInsurerResponse(this)">Registrar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Responder Objeción Aseguradora -->
      <div id="respond" class="tab-content">
        <div class="search-filters">
          <div class="filter-group">
            <label for="respond-rad-number">No. Radicado Externo</label>
            <input type="text" id="respond-rad-number">
          </div>
          <div class="filter-group">
            <label for="respond-invoice-number">No. Factura</label>
            <input type="text" id="respond-invoice-number">
          </div>
          <div class="filter-group">
            <label for="respond-objection-date">Fecha Objeción</label>
            <input type="date" id="respond-objection-date">
          </div>
          <div class="filter-group">
            <label for="respond-invoice-status">Estado Factura</label>
            <select id="respond-invoice-status">
              <option value="OBJ">Objetada</option>
            </select>
          </div>
          <button class="btn search-button" onclick="searchRespondObjections()">Buscar</button>
        </div>
        
        <div class="user-info">
          <p><strong>Usuario responsable:</strong> JAGUAZAC</p>
          <p><strong>Nombre:</strong> JOHN AGUAZACO</p>
        </div>
        
        <div class="invoice-header">
          <div class="invoice-card">
            <h4>No. Rad Ext</h4>
            <p id="respond-rad-ext">00001</p>
          </div>
          <div class="invoice-card">
            <h4>Factura</h4>
            <p id="respond-invoice">80003922</p>
          </div>
          <div class="invoice-card">
            <h4>Fecha Rad</h4>
            <p id="respond-rad-date">08.01.2025</p>
          </div>
          <div class="invoice-card">
            <h4>Responsable Pago</h4>
            <p id="respond-payer">Asegurador 1</p>
          </div>
          <div class="invoice-card">
            <h4>Estado</h4>
            <p id="respond-status"><span class="status-badge status-obj">Objetada</span></p>
          </div>
          <div class="invoice-card">
            <h4>Valor</h4>
            <p id="respond-value">100.000</p>
          </div>
        </div>
        
        <div class="objections-detail">
          <h3>Detalle objeciones</h3>
          <table>
            <thead>
              <tr>
                <th></th>
                <th>Posición</th>
                <th>Servicio</th>
                <th>Descripción</th>
                <th>Valor Servicio</th>
                <th>Valor Pagador</th>
                <th>Motivo Objeción</th>
                <th>Valor Prestador</th>
                <th>Nota Pagador</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="respond-objections-table">
              <tr>
                <td><input type="checkbox"></td>
                <td>360701</td>
                <td>Com. UJ W. Gramsci</td>
                <td>Consulta Urgencias</td>
                <td>50.000</td>
                <td>30.000</td>
                <td>No Cubierto</td>
                <td>30.000</td>
                <td>
                  <i class="fas fa-search note-icon" onclick="showNotePopup(this, 'Nota del pagador: Aceptamos parcialmente')"></i>
                </td>
                <td><span class="traffic-light yellow"></span></td>
                <td>
                  <button class="btn" onclick="respondToInsurer(this)">Responder</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Consultar Objeciones -->
      <div id="consult" class="tab-content">
        <div class="search-filters">
          <div class="filter-group">
            <label for="consult-rad-number">No. Radicado Externo</label>
            <input type="text" id="consult-rad-number">
          </div>
          <div class="filter-group">
            <label for="consult-invoice-number">No. Factura</label>
            <input type="text" id="consult-invoice-number">
          </div>
          <div class="filter-group">
            <label for="consult-rad-date">Fecha Radicación</label>
            <input type="date" id="consult-rad-date">
          </div>
          <div class="filter-group">
            <label for="consult-dev-date">Fecha Devolución</label>
            <input type="date" id="consult-dev-date">
          </div>
          <div class="filter-group">
            <label for="consult-invoice-status">Estado Factura</label>
            <select id="consult-invoice-status">
              <option value="">Todos</option>
              <option value="OBJ">Objetada</option>
              <option value="OCO">Contestada</option>
              <option value="ROA">Respuesta Aseguradora</option>
            </select>
          </div>
          <button class="btn search-button" onclick="searchConsultObjections()">Buscar</button>
        </div>
        
        <div class="table-section">
          <h3>Facturas</h3>
          <table>
            <thead>
              <tr>
                <th>No. Rad Ext</th>
                <th>Factura</th>
                <th>Fecha Rad</th>
                <th>Responsable Pago</th>
                <th>Estado</th>
                <th>Fecha Objeción</th>
                <th>Hora Objeción</th>
                <th>Motivo Objeción</th>
                <th>Usuario Asignado</th>
                <th>Ver Archivos</th>
                <th>Imprimir</th>
              </tr>
            </thead>
            <tbody id="consult-objections-table">
              <tr>
                <td>00001</td>
                <td>80003922</td>
                <td>08.01.2025</td>
                <td>Asegurador 1</td>
                <td><span class="status-badge status-obj">Objetada</span></td>
                <td>10.01.2025</td>
                <td>14:30</td>
                <td>No Cubierto</td>
                <td>JAGUAZAC</td>
                <td><i class="fas fa-file-alt note-icon" onclick="showFilesPopup(this)"></i></td>
                <td><i class="fas fa-print note-icon" onclick="printObjection(this)"></i></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Resultados -->
      <div id="results" class="tab-content">
        <div class="search-filters">
          <div class="filter-group">
            <label for="results-rad-number">No. Radicado Externo</label>
            <input type="text" id="results-rad-number">
          </div>
          <div class="filter-group">
            <label for="results-invoice-number">No. Factura</label>
            <input type="text" id="results-invoice-number">
          </div>
          <div class="filter-group">
            <label for="results-start-date">Fecha Inicio</label>
            <input type="date" id="results-start-date">
          </div>
          <div class="filter-group">
            <label for="results-end-date">Fecha Fin</label>
            <input type="date" id="results-end-date">
          </div>
          <div class="filter-group">
            <label for="results-status">Estado</label>
            <select id="results-status">
              <option value="">Todos</option>
              <option value="OBJ">Objetada</option>
              <option value="OCO">Contestada</option>
              <option value="ROA">Respuesta Aseguradora</option>
              <option value="CON">Conciliada</option>
            </select>
          </div>
          <button class="btn search-button" onclick="searchResults()">Buscar</button>
        </div>
        
        <div class="table-section">
          <h3>Resultados de Objeciones</h3>
          <table>
            <thead>
              <tr>
                <th>No. Rad Ext</th>
                <th>Factura</th>
                <th>Fecha Rad</th>
                <th>Responsable Pago</th>
                <th>Estado</th>
                <th>Valor Factura</th>
                <th>Valor Objetado</th>
                <th>Valor Aceptado</th>
                <th>Diferencia</th>
                <th>Fecha Respuesta</th>
                <th>Usuario</th>
              </tr>
            </thead>
            <tbody id="results-table">
              <tr>
                <td>00001</td>
                <td>80003922</td>
                <td>08.01.2025</td>
                <td>Asegurador 1</td>
                <td><span class="status-badge status-oco">Contestada</span></td>
                <td>100.000</td>
                <td>30.000</td>
                <td>25.000</td>
                <td>5.000</td>
                <td>15.01.2025</td>
                <td>JAGUAZAC</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Popup para notas -->
      <div class="note-popup" id="notePopup"></div>
      
      <!-- Modal para responder objeción -->
      <div id="responseModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('responseModal')">&times;</span>
          <h3>Responder Objeción</h3>
          <div class="form-group">
            <label for="responseNote">Nota de Respuesta:</label>
            <textarea id="responseNote" rows="4" style="width: 100%;"></textarea>
          </div>
          <div class="modal-buttons">
            <button class="btn accept" onclick="saveResponse()">Aceptar</button>
            <button class="btn cancel" onclick="closeModal('responseModal')">Cancelar</button>
          </div>
        </div>
      </div>
      
      <!-- Modal para archivos -->
      <div id="filesModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('filesModal')">&times;</span>
          <h3>Archivos Adjuntos</h3>
          <ul id="filesList">
            <li><a href="#" onclick="viewFile('Factura_80003922.pdf')">Factura_80003922.pdf</a></li>
            <li><a href="#" onclick="viewFile('RIPS_80003922.pdf')">RIPS_80003922.pdf</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Función para cambiar entre pestañas
    function openTab(tabName) {
      // Ocultar todos los contenidos de pestañas
      const tabContents = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
      }
      
      // Desactivar todas las pestañas
      const tabs = document.getElementsByClassName('tab');
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
      }
      
      // Mostrar la pestaña seleccionada y activar el botón
      document.getElementById(tabName).classList.add('active');
      event.currentTarget.classList.add('active');
    }
    
    // Función para mostrar el popup de notas
    function showNotePopup(element, note) {
      const popup = document.getElementById('notePopup');
      popup.innerHTML = note;
      popup.style.display = 'block';
      
      // Posicionar el popup cerca del icono
      const rect = element.getBoundingClientRect();
      popup.style.left = `${rect.left}px`;
      popup.style.top = `${rect.bottom}px`;
      
      // Cerrar el popup al hacer clic en cualquier lugar
      setTimeout(() => {
        document.addEventListener('click', closeNotePopup);
      }, 100);
    }
    
    function closeNotePopup() {
      document.getElementById('notePopup').style.display = 'none';
      document.removeEventListener('click', closeNotePopup);
    }
    
    // Función para mostrar el modal de archivos
    function showFilesPopup(element) {
      document.getElementById('filesModal').style.display = 'block';
      event.stopPropagation(); // Evitar que se active el closeNotePopup
    }
    
    // Función para ver un archivo
    function viewFile(filename) {
      alert(`Visualizando archivo: ${filename}`);
      closeModal('filesModal');
    }
    
    // Función para imprimir una objeción
    function printObjection(element) {
      alert('Imprimiendo detalles de la objeción...');
    }
    
    // Funciones para abrir/cerrar modales
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    // Función para contestar una objeción
    function contestObjection(button) {
      const row = button.closest('tr');
      const position = row.cells[0].textContent;
      const invoiceNumber = document.getElementById('contest-invoice').textContent;
      const providerValue = row.querySelector('.provider-value').value;
      
      // Guardar en localStorage
      const objection = {
        invoiceNumber,
        position,
        providerValue,
        status: 'OCO',
        date: new Date().toLocaleDateString()
      };
      
      saveObjection(objection);
      
      alert(`Objeción contestada exitosamente para la posición ${position} de la factura ${invoiceNumber}`);
      
      // Actualizar estado en la interfaz
      row.querySelector('button').disabled = true;
      row.querySelector('button').textContent = 'Contestada';
      row.querySelector('button').style.backgroundColor = '#4caf50';
    }
    
    // Función para registrar respuesta de aseguradora
    function registerInsurerResponse(button) {
      const row = button.closest('tr');
      const position = row.cells[0].textContent;
      const invoiceNumber = document.getElementById('register-invoice').textContent;
      const insurerValue = row.querySelector('.insurer-value').value;
      
      // Guardar en localStorage
      const objection = {
        invoiceNumber,
        position,
        insurerValue,
        status: 'ROA',
        date: new Date().toLocaleDateString()
      };
      
      saveObjection(objection);
      
      alert(`Respuesta de aseguradora registrada exitosamente para la posición ${position} de la factura ${invoiceNumber}`);
      
      // Actualizar estado en la interfaz
      button.disabled = true;
      button.textContent = 'Registrada';
      button.style.backgroundColor = '#2196f3';
    }
    
    // Función para responder a objeción de aseguradora
    function respondToInsurer(button) {
      openModal('responseModal');
      currentResponseButton = button;
    }
    
    // Función para guardar respuesta
    function saveResponse() {
      const responseNote = document.getElementById('responseNote').value;
      if (!responseNote) {
        alert('Por favor ingrese una nota de respuesta');
        return;
      }
      
      const row = currentResponseButton.closest('tr');
      const position = row.cells[1].textContent;
      const invoiceNumber = document.getElementById('respond-invoice').textContent;
      
      // Guardar en localStorage
      const objection = {
        invoiceNumber,
        position,
        responseNote,
        status: 'OCO',
        date: new Date().toLocaleDateString()
      };
      
      saveObjection(objection);
      
      alert(`Respuesta a objeción guardada exitosamente para la posición ${position} de la factura ${invoiceNumber}`);
      
      // Actualizar estado en la interfaz
      currentResponseButton.disabled = true;
      currentResponseButton.textContent = 'Respondida';
      currentResponseButton.style.backgroundColor = '#4caf50';
      row.querySelector('.traffic-light').classList.remove('yellow');
      row.querySelector('.traffic-light').classList.add('green');
      
      closeModal('responseModal');
    }
    
    // Función para guardar objeciones en localStorage
    function saveObjection(objection) {
      let objections = JSON.parse(localStorage.getItem('objections')) || [];
      
      // Buscar si ya existe una objeción para esta factura y posición
      const existingIndex = objections.findIndex(obj => 
        obj.invoiceNumber === objection.invoiceNumber && obj.position === objection.position
      );
      
      if (existingIndex >= 0) {
        // Actualizar objeción existente
        objections[existingIndex] = objection;
      } else {
        // Agregar nueva objeción
        objections.push(objection);
      }
      
      localStorage.setItem('objections', JSON.stringify(objections));
    }
    
    // Funciones de búsqueda (simuladas)
    function searchContestObjections() {
      alert('Buscando facturas objetadas...');
    }
    
    function searchRegisterResponses() {
      alert('Buscando respuestas a objeciones...');
    }
    
    function searchRespondObjections() {
      alert('Buscando objeciones para responder...');
    }
    
    function searchConsultObjections() {
      alert('Buscando objeciones para consultar...');
    }
    
    function searchResults() {
      alert('Buscando resultados de objeciones...');
    }
    
    // Cargar datos iniciales
    document.addEventListener('DOMContentLoaded', function() {
      // Simular carga de datos desde localStorage
      const savedObjections = JSON.parse(localStorage.getItem('objections')) || [];
      console.log('Objeciones guardadas:', savedObjections);
    });
  </script>
</body>
</html>