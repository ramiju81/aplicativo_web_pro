<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <title>Cloud Medical Fees mySiss</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: white;
    }

    .container {
      display: flex;
    }

    .sidebar {
      width: 180px;
      background-color: #eee6f8;
      padding: 20px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex-grow: 1; 
    }

    .sidebar-footer {
      margin-top: auto;
      margin-bottom: 10px; 
    }
    
    .sidebar a[href="login.html"] {
      position: relative;
      bottom: 30px;
    }

    a[href="login.html"] {
      position: relative;
      bottom: 10px;
    }

    .logout {
      color: purple;
      text-decoration: none;
      font-weight: bold;
    }
    
    .sidebar h1 {
      color: purple;
      font-weight: bold;
      font-size: 50px;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      margin: 20px 0;
      color: purple;
      text-decoration: none;
      font-weight: bold;
    }

    .main {
      margin-left: 240px;
      flex: 1;
      background-color: white;
      padding: 20px 40px;
    }
    
    .radio-group {
      display: flex;  
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .radio-group label {
      display: inline-flex;
      align-items: center;
      margin-right: 30px;
      gap: 0px;
    }

    .form-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    label {
      min-width: 140px;
    }

    input, select {
      padding: 6px;
      width: 200px;
    }

    .btn {
      padding: 8px 16px;
      margin-top: 10px;
      margin-right: 10px;
      background-color: purple;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .table-section {
      background-color: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }

    table th, table td {
      border: 1px solid #ccc;
      padding: 4px;
      text-align: left;
    }

    table th {
      background-color: #f0f0f0;
    }
    
    th.col-select, td.col-select {
      width: 20px;
      min-width: 20px;
      max-width: 20px;
      padding: 0;
      text-align: center;
      vertical-align: middle;
      position: relative;
    }

    td.col-select input[type="checkbox"],
    th.col-select input[type="checkbox"] {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      padding: 0;
    }

    h3 {
      font-size: 16px;
      margin-top: 0;
    }
    
    .subrayado {
      text-decoration: underline;
    }
    
    td.col-select {
      position: relative;
      width: 40px;
      padding: 0;
    }

    .btn-icon {
      display: inline-block;
      padding: 8px;
      border-radius: 8px;
      background-color: purple; 
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-left: 40px;
    }

    .btn-icon:hover {
      background-color: #b80bd7;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
    }
        
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
      position: relative;
    }
        
    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
        
    .close:hover {
      color: black;
    }
        
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
        
    .modal-buttons button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
        
    .modal-buttons .accept {
      background-color: purple;
      color: white;
    }
        
    .modal-buttons .cancel {
      background-color: #ddd;
    }

    /* Estilos adicionales */
    .tab-container {
      display: flex;
      margin-bottom: 20px;
    }
    
    .tab {
      padding: 10px 20px;
      background-color: #eee6f8;
      color: purple;
      cursor: pointer;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
      font-weight: bold;
    }
    
    .tab.active {
      background-color: purple;
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .semaforo {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin: 0 auto;
    }
    
    .semaforo.rojo {
      background-color: #ff0000;
    }
    
    .semaforo.verde {
      background-color: #00cc00;
    }
    
    .ver-archivos {
      color: purple;
      cursor: pointer;
      text-decoration: underline;
    }
    
    .ver-detalle {
      color: purple;
      cursor: pointer;
      font-weight: bold;
    }
    
    /* Estilos para el modal de soportes */
    .modal-soportes {
      width: 80%;
      max-width: 800px;
    }
    
    .modal-soportes-content {
      padding: 20px;
    }
    
    .soportes-list {
      margin-top: 15px;
    }
    
    .soporte-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .soporte-item div {
      flex: 1;
    }
    
    .soporte-item div:first-child {
      flex: 0 0 100px;
    }
    
    .soporte-item div:nth-child(2) {
      flex: 2;
    }
    
    /* Estilos para el formulario PDF */
    .pdf-preview {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      margin-top: 15px;
    }
    
    /* Estilos para mensajes */
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .message.success {
      background-color: #dff0d8;
      color: #3c763d;
    }
    
    .message.error {
      background-color: #f2dede;
      color: #a94442;
    }
    
    .message.info {
      background-color: #d9edf7;
      color: #31708f;
    }
	
.btn-container {
  text-align: right;
  margin: 10px 0;
  padding-right: 10px; /* Ajusta seg煤n necesites */
}

.btn-cargar-datos {
  background-color: purple;
  color: white;
  border: none;
  padding: 8px 15px; /* M谩s compacto */
  font-size: 14px;
  border-radius: 5px;
  cursor: pointer;
  display: inline-block; /* Para que el ancho se ajuste al contenido */
  transition: background-color 0.3s;
  white-space: nowrap; /* Evita que el texto se parta */
}

.btn-cargar-datos:hover {
  background-color: #6a0dad;
}

#secret-clear-btn {
  position: fixed;
  bottom: 10px;
  right: 10px;
  width: 30px;
  height: 30px;
  background-color: #ff000033; /* Rojo muy transparente */
  color: transparent;
  border-radius: 50%;
  cursor: pointer;
  text-align: center;
  line-height: 30px;
  font-size: 16px;
  z-index: 9999;
  transition: all 0.3s;
  border: 1px dashed #ff000066;
}

#secret-clear-btn:hover {
  background-color: #ff0000aa; /* Rojo m谩s visible al hover */
  color: white;
  transform: scale(1.2);
}

  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="sidebar-content">
        <h1>mySiss</h1>
        <a href="index.html" style="text-decoration: underline;">Radicacion de facturas</a>
        <a href="dev_Fact.html">Devolucion de facturas</a>
        <a href="carg_obj.html">Cargue de objeciones</a>
        <a href="gest_obj.html">Gestion de objeciones</a>
        <a href="conc_obj.html">Conciliacion de objeciones</a>
      </div>
      <a href="../login.html" class="logout">Cerrar sesi贸n</a>
    </div>

    <div class="main">
      <h2>Gesti贸n de Facturas y Glosas</h2>
      <!-- Dentro del div.sidebar-content, agrega este enlace -->
<div class="btn-container">
  <button onclick="cargarDatosIniciales()" class="btn-cargar-datos">
    Cargar Datos
  </button>
</div>

      <div class="tab-container">
        <div class="tab active" onclick="openTab(event, 'radicar')">Radicar facturas</div>
        <div class="tab" onclick="openTab(event, 'actualizar')">Actualizar radicaci贸n</div>
        <div class="tab" onclick="openTab(event, 'consultar')">Consultar facturas radicadas</div>
      </div>
      
      <!-- Contenido de Radicar facturas -->
      <div id="radicar" class="tab-content active">
        <div class="form-section">
          <h3>Criterios de b煤squeda</h3>
          <div class="form-row">
            <label for="pagador">Pagador:</label>
            <select id="pagador">
              <option value="">Seleccione un pagador</option>
            </select>
            
            <label for="estado-factura">Estado factura:</label>
            <select id="estado-factura">
              <option value="GENERADA">GENERADA</option>
              <option value="DEVUELTA">DEVUELTA</option>
            </select>
          </div>
          
          <div class="form-row">
            <label for="fecha-inicio">Fecha inicio facturaci贸n:</label>
            <input type="date" id="fecha-inicio">
            
            <label for="fecha-fin">Fecha fin facturaci贸n:</label>
            <input type="date" id="fecha-fin">
          </div>
          
          <button class="btn" onclick="buscarFacturas()">Buscar</button>
        </div>
        
        <div class="table-section">
          <h3>Facturas</h3>
          <div id="message-area-radicar"></div>
          <table id="tabla-facturas">
            <thead>
              <tr>
                <th class="col-select"><input type="checkbox" onclick="toggleSelectAll(this)"></th>
                <th class="col-select"></th>
                <th>N煤mero caso</th>
                <th>Identificaci贸n pagador</th>
                <th>Nombre pagador</th>
                <th>N煤mero de factura</th>
                <th>Fecha factura</th>
                <th>Estado factura</th>
                <th>Valor factura</th>
                <th>Ver archivos</th>
                <th>Semaforizaci贸n</th>
              </tr>
            </thead>
            <tbody id="facturas-body">
              <!-- Datos se cargar谩n din谩micamente -->
            </tbody>
          </table>
          
          <div id="detalle-factura-container" class="hidden">
            <h4>Detalle de la factura</h4>
            <table id="detalle-factura">
              <thead>
                <tr>
                  <th>Consecutivo servicio</th>
                  <th>C贸digo servicio facturado</th>
                  <th>Descripci贸n servicio</th>
                  <th>Cantidad servicio</th>
                  <th>Valor servicio</th>
                </tr>
              </thead>
              <tbody>
                <!-- Detalle se cargar谩 din谩micamente -->
              </tbody>
            </table>
          </div>
          
          <button id="btn-radicar" class="btn hidden" onclick="radicarFacturas()">Radicar</button>
          <button id="btn-relacion" class="btn hidden" onclick="generarRelacionRadicacion()">Relaci贸n facturas radicadas</button>
        </div>
      </div>
      
      <!-- Contenido de Actualizar radicaci贸n -->
      <div id="actualizar" class="tab-content">
        <div class="form-section">
          <h3>Criterios de b煤squeda</h3>
          <div class="form-row">
            <label for="num-radicado-int">No. Radicado Interno:</label>
            <input type="text" id="num-radicado-int">
            
            <label for="estado-factura-act">Estado factura:</label>
            <select id="estado-factura-act">
              <option value="RADICADA">RADICADA</option>
            </select>
          </div>
          
          <div class="form-row">
            <label for="fecha-inicio-act">Fecha inicio radicaci贸n:</label>
            <input type="date" id="fecha-inicio-act">
            
            <label for="fecha-fin-act">Fecha fin radicaci贸n:</label>
            <input type="date" id="fecha-fin-act">
          </div>
          
          <button class="btn" onclick="buscarFacturasRadicadas()">Buscar</button>
        </div>
        
        <div class="table-section">
          <h3>Facturas</h3>
          <div id="message-area-actualizar"></div>
          <table id="tabla-facturas-act">
            <thead>
              <tr>
                <th class="col-select"><input type="checkbox" onclick="toggleSelectAllActualizar(this)"></th>
                <th class="col-select"></th>
                <th>N煤mero radicaci贸n interno</th>
                <th>Fecha radicaci贸n interno</th>
                <th>Nombre pagador</th>
                <th>N煤mero caso</th>
                <th>N煤mero de factura</th>
                <th>Estado factura</th>
                <th>Valor factura</th>
                <th>Ver archivos</th>
                <th>Semaforizaci贸n</th>
                <th>No. Radicado externo</th>
                <th>Fecha y Hora Radicaci贸n Externa</th>
                <th>Usuario modifica</th>
              </tr>
            </thead>
            <tbody id="facturas-act-body">
              <!-- Datos se cargar谩n din谩micamente -->
            </tbody>
          </table>
          
          <div id="detalle-factura-act-container" class="hidden">
            <h4>Detalle de la factura</h4>
            <table id="detalle-factura-act">
              <thead>
                <tr>
                  <th>Consecutivo servicio</th>
                  <th>C贸digo servicio facturado</th>
                  <th>Descripci贸n servicio</th>
                  <th>Cantidad servicio</th>
                  <th>Valor servicio</th>
                </tr>
              </thead>
              <tbody>
                <!-- Detalle se cargar谩 din谩micamente -->
              </tbody>
            </table>
          </div>
          
          <div id="actualizar-radicado-container" class="hidden">
            <div class="form-row">
              <label for="num-radicado-ext">No. Radicado externo:</label>
              <input type="text" id="num-radicado-ext">
              <button class="btn" onclick="actualizarRadicacion()">Actualizar No. Radicaci贸n</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Contenido de Consultar facturas radicadas -->
      <div id="consultar" class="tab-content">
        <div class="form-section">
          <h3>Criterios de b煤squeda</h3>
          <div class="form-row">
            <label for="num-radicado-ext-cons">No. Radicado Externo:</label>
            <input type="text" id="num-radicado-ext-cons">
            
            <label for="num-factura-cons">No. Factura:</label>
            <input type="text" id="num-factura-cons">
            
            <label for="estado-factura-cons">Estado factura:</label>
            <select id="estado-factura-cons">
              <option value="RADICADA">RADICADA</option>
            </select>
          </div>
          
          <div class="form-row">
            <label for="fecha-inicio-cons">Fecha inicio radicaci贸n:</label>
            <input type="date" id="fecha-inicio-cons">
            
            <label for="fecha-fin-cons">Fecha fin radicaci贸n:</label>
            <input type="date" id="fecha-fin-cons">
          </div>
          
          <button class="btn" onclick="buscarFacturasRadicadasConsultar()">Buscar</button>
        </div>
        
        <div class="table-section">
          <h3>Facturas</h3>
          <div id="message-area-consultar"></div>
          <table id="tabla-facturas-cons">
            <thead>
              <tr>
                <th class="col-select"><input type="checkbox" onclick="toggleSelectAllConsultar(this)"></th>
                <th class="col-select"></th>
                <th>N煤mero caso</th>
                <th>N煤mero de factura</th>
                <th>Estado factura</th>
                <th>Nombre pagador</th>
                <th>Valor factura</th>
                <th>N煤mero radicaci贸n interno</th>
                <th>Fecha radicaci贸n interno</th>
                <th>Usuario radica</th>
                <th>No. Radicaci贸n externo</th>
                <th>Fecha y Hora radicaci贸n externa</th>
                <th>Usuario modifica</th>
                <th>Ver archivos</th>
                <th>Semaforizaci贸n</th>
              </tr>
            </thead>
            <tbody id="facturas-cons-body">
              <!-- Datos se cargar谩n din谩micamente -->
            </tbody>
          </table>
          
          <div id="detalle-factura-cons-container" class="hidden">
            <h4>Detalle de la factura</h4>
            <table id="detalle-factura-cons">
              <thead>
                <tr>
                  <th>Consecutivo servicio</th>
                  <th>C贸digo servicio facturado</th>
                  <th>Descripci贸n servicio</th>
                  <th>Cantidad servicio</th>
                  <th>Valor servicio</th>
                </tr>
              </thead>
              <tbody>
                <!-- Detalle se cargar谩 din谩micamente -->
              </tbody>
            </table>
          </div>
          
          <button id="btn-relacion-cons" class="btn hidden" onclick="generarRelacionRadicacionConsultar()">Relaci贸n facturas radicadas</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para ver soportes -->
  <div id="modal-soportes" class="modal">
    <div class="modal-content modal-soportes">
      <span class="close" onclick="closeModal('modal-soportes')">&times;</span>
      <div class="modal-soportes-content">
        <h3>Ver Soportes</h3>
        <p>A trav茅s de esta opci贸n, se podr谩n visualizar los soportes que se adjuntaron para cada factura</p>
        
        <div class="soportes-list">
          <div class="soporte-item">
            <div><strong>ID Soporte</strong></div>
            <div><strong>Descripci贸n Soporte</strong></div>
            <div><strong>Semaforizaci贸n</strong></div>
            <div><strong>Visualizar</strong></div>
          </div>
          <div id="soportes-list-body">
            <!-- Soportes se cargar谩n din谩micamente -->
          </div>
        </div>
        
        <div id="log-validaciones" style="margin-top: 20px;">
          <h4>Log de validaciones</h4>
          <div id="log-messages"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para radicaci贸n exitosa -->
  <div id="modal-radicacion" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('modal-radicacion')">&times;</span>
      <h3>Radicaci贸n exitosa</h3>
      <p id="radicacion-message"></p>
      <div class="modal-buttons">
        <button class="accept" onclick="closeModal('modal-radicacion')">Aceptar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal para relaci贸n de radicaci贸n -->
  <div id="modal-relacion" class="modal">
    <div class="modal-content modal-soportes">
      <span class="close" onclick="closeModal('modal-relacion')">&times;</span>
      <div class="modal-soportes-content">
        <h3>Relaci贸n de Facturas Radicadas</h3>
        <div class="pdf-preview" id="pdf-preview">
          <!-- Vista previa del PDF se cargar谩 din谩micamente -->
        </div>
        <div class="modal-buttons">
          <button class="btn" onclick="descargarPDF()">Descargar PDF</button>
          <button class="btn" onclick="imprimirPDF()">Imprimir</button>
          <button class="btn cancel" onclick="closeModal('modal-relacion')">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para actualizaci贸n exitosa -->
  <div id="modal-actualizacion" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('modal-actualizacion')">&times;</span>
      <h3>Actualizaci贸n exitosa</h3>
      <p>No. Radicado actualizado exitosamente</p>
      <div class="modal-buttons">
        <button class="accept" onclick="closeModal('modal-actualizacion')">Aceptar</button>
      </div>
    </div>
  </div>
  
<div id="secret-clear-btn" title="Limpiar localStorage (admin)">
  Ч
</div>

<!-- Contenedor de mensajes - A帽ade esto cerca del bot贸n -->
<div id="mensajeCarga" style="display: none;"></div>

<!-- Script al final del body -->
<script src="cargar_datos.js"></script>

  <script>
    // Variables globales
    let facturas = [];
    let facturasRadicadas = [];
    let facturasConsultar = [];
    let currentFacturaId = null;
    let currentRadicadoId = null;
    let currentSoportes = [];
    
    // Inicializaci贸n al cargar la p谩gina
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar datos iniciales
      cargarDatosIniciales();
      
      // Configurar fechas por defecto
      const today = new Date();
      const oneMonthAgo = new Date();
      oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
      
      document.getElementById('fecha-inicio').valueAsDate = oneMonthAgo;
      document.getElementById('fecha-fin').valueAsDate = today;
      document.getElementById('fecha-inicio-act').valueAsDate = oneMonthAgo;
      document.getElementById('fecha-fin-act').valueAsDate = today;
      document.getElementById('fecha-inicio-cons').valueAsDate = oneMonthAgo;
      document.getElementById('fecha-fin-cons').valueAsDate = today;
      
      // Cargar datos desde localStorage
      cargarDesdeLocalStorage();
    });
    
    // Funci贸n para cambiar entre pesta帽as
    function openTab(evt, tabName) {
      const tabContents = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
      }
      
      const tabs = document.getElementsByClassName('tab');
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
      }
      
      document.getElementById(tabName).classList.add('active');
      evt.currentTarget.classList.add('active');
      
      // Limpiar mensajes al cambiar de pesta帽a
      document.getElementById('message-area-radicar').innerHTML = '';
      document.getElementById('message-area-actualizar').innerHTML = '';
      document.getElementById('message-area-consultar').innerHTML = '';
    }
    
    // Funci贸n para cargar datos iniciales
    function cargarDatosIniciales() {
      // Cargar pagadores (aseguradoras)
      const pagadorSelect = document.getElementById('pagador');
      pagadorSelect.innerHTML = '<option value="">Seleccione un pagador</option>';
      
      // Datos de ejemplo - en una aplicaci贸n real estos vendr铆an de una API o base de datos
      const aseguradoras = [
        { id: 1, nombre: 'EPS Sanitas', nit: '8000152350' },
        { id: 2, nombre: 'EPS Sura', nit: '8000152351' },
        { id: 3, nombre: 'EPS Coomeva', nit: '8000152352' }
      ];
      
      aseguradoras.forEach(aseguradora => {
        const option = document.createElement('option');
        option.value = aseguradora.id;
        option.textContent = `${aseguradora.nombre} (${aseguradora.nit})`;
        pagadorSelect.appendChild(option);
      });
      
      // Si hay datos en localStorage, cargarlos
      if (localStorage.getItem('facturas')) {
        facturas = JSON.parse(localStorage.getItem('facturas'));
      } else {
        // Datos de ejemplo para facturas
        facturas = [
          {
            id: 1,
            numCaso: '1001',
            nitAseguradora: '8000152350',
            nombreAseguradora: 'EPS Sanitas',
            numFactura: 'FAC-001',
            fechaFact: '2025-02-01',
            idEstFact: 'GE',
            estFact: 'GENERADA',
            vrFactura: 1500000,
            servicios: [
              { consServ: 1, codServFact: 'SER001', descripServ: 'Consulta m茅dica general', cantServ: 1, vrServ: 50000 },
              { consServ: 2, codServFact: 'SER002', descripServ: 'Examen de laboratorio', cantServ: 2, vrServ: 725000 }
            ],
            soportes: [
              { idSoporte: 'FEV', descripcion: 'Factura de venta', nombreArchivo: 'FEV_FAC-001.pdf', semaforizacion: 'verde' },
              { idSoporte: 'EPI', descripcion: 'Epicrisis', nombreArchivo: 'EPI_FAC-001.pdf', semaforizacion: 'verde' }
            ]
          },
          {
            id: 2,
            numCaso: '1002',
            nitAseguradora: '8000152351',
            nombreAseguradora: 'EPS Sura',
            numFactura: 'FAC-002',
            fechaFact: '2025-02-05',
            idEstFact: 'DE',
            estFact: 'DEVUELTA',
            vrFactura: 2300000,
            servicios: [
              { consServ: 1, codServFact: 'SER003', descripServ: 'Ecograf铆a', cantServ: 1, vrServ: 120000 },
              { consServ: 2, codServFact: 'SER004', descripServ: 'Radiograf铆a', cantServ: 1, vrServ: 80000 },
              { consServ: 3, codServFact: 'SER005', descripServ: 'Terapia f铆sica', cantServ: 5, vrServ: 2100000 }
            ],
            soportes: [
              { idSoporte: 'FEV', descripcion: 'Factura de venta', nombreArchivo: 'FEV_FAC-002.pdf', semaforizacion: 'verde' },
              { idSoporte: 'EPI', descripcion: 'Epicrisis', nombreArchivo: 'EPI_FAC-002.pdf', semaforizacion: 'rojo' }
            ]
          }
        ];
        
        localStorage.setItem('facturas', JSON.stringify(facturas));
      }
      
      // Cargar facturas radicadas si existen
      if (localStorage.getItem('facturasRadicadas')) {
        facturasRadicadas = JSON.parse(localStorage.getItem('facturasRadicadas'));
      }
      
      // Cargar contador de radicados si existe
      if (!localStorage.getItem('contadorRadicados')) {
        localStorage.setItem('contadorRadicados', '10000');
      }
    }
    
    // Funci贸n para cargar datos desde localStorage
    function cargarDesdeLocalStorage() {
      if (localStorage.getItem('facturas')) {
        facturas = JSON.parse(localStorage.getItem('facturas'));
      }
      
      if (localStorage.getItem('facturasRadicadas')) {
        facturasRadicadas = JSON.parse(localStorage.getItem('facturasRadicadas'));
      }
    }
    
    // Funci贸n para buscar facturas
    function buscarFacturas() {
      const pagadorId = document.getElementById('pagador').value;
      const estadoFactura = document.getElementById('estado-factura').value;
      const fechaInicio = document.getElementById('fecha-inicio').value;
      const fechaFin = document.getElementById('fecha-fin').value;
      
      // Filtrar facturas seg煤n criterios
      let facturasFiltradas = facturas.filter(factura => {
        // Filtrar por estado
        if (estadoFactura && factura.estFact !== estadoFactura) {
          return false;
        }
        
        // Filtrar por pagador
        if (pagadorId) {
          const aseguradora = obtenerAseguradoraPorId(pagadorId);
          if (aseguradora && factura.nitAseguradora !== aseguradora.nit) {
            return false;
          }
        }
        
        // Filtrar por fecha
        if (fechaInicio && new Date(factura.fechaFact) < new Date(fechaInicio)) {
          return false;
        }
        
        if (fechaFin && new Date(factura.fechaFact) > new Date(fechaFin)) {
          return false;
        }
        
        return true;
      });
      
      // Mostrar facturas en la tabla
      mostrarFacturas(facturasFiltradas);
      
      // Mostrar u ocultar bot贸n de radicar
      document.getElementById('btn-radicar').classList.add('hidden');
      document.getElementById('btn-relacion').classList.add('hidden');
    }
    
    // Funci贸n para mostrar facturas en la tabla
    function mostrarFacturas(facturas) {
      const tbody = document.getElementById('facturas-body');
      tbody.innerHTML = '';
      
      if (facturas.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="11" style="text-align: center;">No se encontraron facturas con los criterios seleccionados</td>`;
        tbody.appendChild(row);
        return;
      }
      
      facturas.forEach(factura => {
        const row = document.createElement('tr');
        row.dataset.id = factura.id;
        
        // Verificar semaforizaci贸n
        const semaforo = factura.soportes.every(soporte => soporte.semaforizacion === 'verde') ? 'verde' : 'rojo';
        
        row.innerHTML = `
          <td class="col-select"><input type="checkbox" onclick="toggleSelectFactura(this)"></td>
          <td class="col-select"><span class="ver-detalle" onclick="mostrarDetalleFactura(${factura.id})">+</span></td>
          <td>${factura.numCaso}</td>
          <td>${factura.nitAseguradora}</td>
          <td>${factura.nombreAseguradora}</td>
          <td>${factura.numFactura}</td>
          <td>${formatDate(factura.fechaFact)}</td>
          <td>${factura.estFact}</td>
          <td>$${formatNumber(factura.vrFactura)}</td>
          <td><span class="ver-archivos" onclick="mostrarSoportes(${factura.id})">Ver</span></td>
          <td><div class="semaforo ${semaforo}"></div></td>
        `;
        
        tbody.appendChild(row);
      });
    }
    
    // Funci贸n para mostrar el detalle de una factura
    function mostrarDetalleFactura(facturaId) {
      const factura = facturas.find(f => f.id == facturaId);
      if (!factura) return;
      
      const tbody = document.getElementById('detalle-factura').querySelector('tbody');
      tbody.innerHTML = '';
      
      factura.servicios.forEach(servicio => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${servicio.consServ}</td>
          <td>${servicio.codServFact}</td>
          <td>${servicio.descripServ}</td>
          <td>${servicio.cantServ}</td>
          <td>$${formatNumber(servicio.vrServ)}</td>
        `;
        tbody.appendChild(row);
      });
      
      document.getElementById('detalle-factura-container').classList.remove('hidden');
      
      // Resaltar la fila seleccionada
      const rows = document.querySelectorAll('#facturas-body tr');
      rows.forEach(row => {
        row.style.backgroundColor = row.dataset.id == facturaId ? '#f0e6ff' : '';
      });
    }
    
    // Funci贸n para mostrar los soportes de una factura
    function mostrarSoportes(facturaId) {
      const factura = facturas.find(f => f.id == facturaId);
      if (!factura) return;
      
      currentFacturaId = facturaId;
      currentSoportes = factura.soportes;
      
      const soportesBody = document.getElementById('soportes-list-body');
      soportesBody.innerHTML = '';
      
      const logMessages = document.getElementById('log-messages');
      logMessages.innerHTML = '';
      
      factura.soportes.forEach(soporte => {
        const soporteItem = document.createElement('div');
        soporteItem.className = 'soporte-item';
        soporteItem.innerHTML = `
          <div>${soporte.idSoporte}</div>
          <div>${soporte.descripcion}</div>
          <div><div class="semaforo ${soporte.semaforizacion}"></div></div>
          <div>${soporte.semaforizacion === 'verde' ? `<span class="ver-archivos" onclick="verArchivo('${soporte.nombreArchivo}')">Ver</span>` : 'No disponible'}</div>
        `;
        soportesBody.appendChild(soporteItem);
        
        // Agregar mensajes al log si hay errores
        if (soporte.semaforizacion === 'rojo') {
          const logItem = document.createElement('div');
          logItem.className = 'message error';
          logItem.textContent = `El archivo ${soporte.nombreArchivo} (que se encuentra en el OCI), no corresponde`;
          logMessages.appendChild(logItem);
        }
      });
      
      // Mostrar modal
      document.getElementById('modal-soportes').style.display = 'block';
    }
    
    // Funci贸n para ver un archivo (simulaci贸n)
    function verArchivo(nombreArchivo) {
      alert(`Mostrando archivo: ${nombreArchivo}\n\nEn una implementaci贸n real, esto abrir铆a el archivo desde el repositorio OCI.`);
    }
    
    // Funci贸n para seleccionar/deseleccionar todas las facturas
    function toggleSelectAll(checkbox) {
      const checkboxes = document.querySelectorAll('#facturas-body input[type="checkbox"]');
      checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
      });
      
      // Mostrar u ocultar bot贸n de radicar
      document.getElementById('btn-radicar').classList.toggle('hidden', !checkbox.checked);
    }
    
    // Funci贸n para seleccionar/deseleccionar una factura individual
    function toggleSelectFactura(checkbox) {
      const checkAll = document.querySelector('#tabla-facturas thead input[type="checkbox"]');
      const checkboxes = document.querySelectorAll('#facturas-body input[type="checkbox"]');
      
      // Verificar si todos est谩n seleccionados
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkAll.checked = allChecked;
      
      // Mostrar u ocultar bot贸n de radicar
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      document.getElementById('btn-radicar').classList.toggle('hidden', !anyChecked);
    }
    
    // Funci贸n para radicar facturas seleccionadas
    function radicarFacturas() {
      const checkboxes = document.querySelectorAll('#facturas-body input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        showMessage('message-area-radicar', 'Por favor seleccione al menos una factura para radicar', 'error');
        return;
      }
      
      const facturasSeleccionadas = [];
      checkboxes.forEach(checkbox => {
        const row = checkbox.closest('tr');
        const facturaId = parseInt(row.dataset.id);
        const factura = facturas.find(f => f.id === facturaId);
        
        if (factura) {
          // Verificar semaforizaci贸n
          const semaforo = factura.soportes.every(soporte => soporte.semaforizacion === 'verde');
          
          if (!semaforo) {
            showMessage('message-area-radicar', `No es posible radicar la factura ${factura.numFactura}, verifique los soportes`, 'error');
            return;
          }
          
          facturasSeleccionadas.push(factura);
        }
      });
      
      if (facturasSeleccionadas.length === 0) {
        return;
      }
      
      // Generar n煤mero de radicado
      const contador = parseInt(localStorage.getItem('contadorRadicados')) || 10000;
      const numRadicado = contador + 1;
      localStorage.setItem('contadorRadicados', numRadicado.toString());
      
      const fechaHoraRadicacion = new Date().toISOString();
      const usuarioRadica = 'UsuarioDemo'; // En una aplicaci贸n real ser铆a el usuario autenticado
      
      // Actualizar estado de las facturas
      facturasSeleccionadas.forEach(factura => {
        factura.idEstFact = 'RA';
        factura.estFact = 'RADICADA';
        
        // Crear registro de radicaci贸n
        const radicacion = {
          id: Date.now() + Math.floor(Math.random() * 1000),
          numRadicadoInt: numRadicado,
          fechaHoraRadicacion: fechaHoraRadicacion,
          usuarioRadica: usuarioRadica,
          facturas: [factura.id],
          numRadicadoExt: '',
          fechaHoraRadicacionExt: '',
          usuarioModifica: ''
        };
        
        facturasRadicadas.push(radicacion);
      });
      
      // Actualizar localStorage
      localStorage.setItem('facturas', JSON.stringify(facturas));
      localStorage.setItem('facturasRadicadas', JSON.stringify(facturasRadicadas));
      
      // Mostrar mensaje de 茅xito
      const radicacionMessage = document.getElementById('radicacion-message');
      radicacionMessage.innerHTML = `
        <p><strong>No. Radicado:</strong> ${numRadicado}</p>
        <p><strong>Fecha radicaci贸n:</strong> ${formatDate(fechaHoraRadicacion)}</p>
        <p><strong>Hora radicaci贸n:</strong> ${formatTime(fechaHoraRadicacion)}</p>
        <p>La presentaci贸n de los soportes por este medio, no conlleva la aprobaci贸n y pago de la factura. V铆a e-mail se env铆a la relaci贸n de las facturas radicadas junto con sus soportes</p>
      `;
      
      document.getElementById('modal-radicacion').style.display = 'block';
      
      // Mostrar bot贸n de relaci贸n
      document.getElementById('btn-relacion').classList.remove('hidden');
      
      // Actualizar tabla
      buscarFacturas();
    }
    
    // Funci贸n para generar la relaci贸n de radicaci贸n (PDF)
    function generarRelacionRadicacion() {
      // En una implementaci贸n real, esto generar铆a un PDF con la informaci贸n
      // Aqu铆 simulamos la generaci贸n del PDF mostrando un modal con la informaci贸n
      
      const pdfPreview = document.getElementById('pdf-preview');
      pdfPreview.innerHTML = `
        <h3 style="text-align: center;">RELACIN DE FACTURAS RADICADAS</h3>
        <p style="text-align: center;">No. Radicado: ${localStorage.getItem('contadorRadicados')}</p>
        <p style="text-align: center;">Fecha y hora radicaci贸n: ${formatDate(new Date().toISOString())} ${formatTime(new Date().toISOString())}</p>
        
        <h4>INFORMACIN PAGADOR</h4>
        <p>Pagador: EPS Sanitas</p>
        <p>Tipo y No Pagador: NIT 8000152350</p>
        
        <h4>INFORMACIN PRESTADOR</h4>
        <p>Nombre: Cl铆nica Demo</p>
        <p>NIT: 900123456-1</p>
        <p>Direcci贸n: Calle 123 #45-67</p>
        <p>Departamento: Cundinamarca</p>
        <p>Ciudad: Bogot谩</p>
        <p>Tel茅fono: 6012345678</p>
        <p>E-Mail: contacto@clinicademo.com</p>
        
        <h4>INFORMACIN SEDE QUE RADICA</h4>
        <p>Sede: Principal</p>
        
        <h4>SOPORTES DE RADICADO</h4>
        <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <thead>
            <tr>
              <th>FACTURA</th>
              <th>TIPO DOCUMENTO</th>
              <th>ARCHIVO NOMBRADO</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>FAC-001</td>
              <td>FACTURA DE VENTA</td>
              <td>FEV_FAC-001.pdf</td>
            </tr>
            <tr>
              <td>FAC-001</td>
              <td>EPICRISIS</td>
              <td>EPI_FAC-001.pdf</td>
            </tr>
          </tbody>
        </table>
      `;
      
      document.getElementById('modal-relacion').style.display = 'block';
      
      // Simular env铆o por correo
      setTimeout(() => {
        console.log('Correo enviado al pagador con la relaci贸n de facturas radicadas');
      }, 1000);
    }
    
    // Funci贸n para buscar facturas radicadas (pesta帽a Actualizar radicaci贸n)
    function buscarFacturasRadicadas() {
      const numRadicadoInt = document.getElementById('num-radicado-int').value;
      const estadoFactura = document.getElementById('estado-factura-act').value;
      const fechaInicio = document.getElementById('fecha-inicio-act').value;
      const fechaFin = document.getElementById('fecha-fin-act').value;
      
      // Filtrar facturas radicadas seg煤n criterios
      let radicacionesFiltradas = facturasRadicadas.filter(radicacion => {
        // Filtrar por n煤mero de radicado
        if (numRadicadoInt && radicacion.numRadicadoInt.toString() !== numRadicadoInt) {
          return false;
        }
        
        // Filtrar por fecha
        if (fechaInicio && new Date(radicacion.fechaHoraRadicacion) < new Date(fechaInicio)) {
          return false;
        }
        
        if (fechaFin && new Date(radicacion.fechaHoraRadicacion) > new Date(fechaFin)) {
          return false;
        }
        
        // Verificar que las facturas asociadas est茅n en estado RADICADA
        const facturasAsociadas = radicacion.facturas.map(id => 
          facturas.find(f => f.id === id && f.estFact === 'RADICADA')
        ).filter(Boolean);
        
        return facturasAsociadas.length > 0;
      });
      
      // Mostrar radicaciones en la tabla
      mostrarFacturasRadicadas(radicacionesFiltradas);
      
      // Ocultar secci贸n de actualizaci贸n
      document.getElementById('actualizar-radicado-container').classList.add('hidden');
    }
    
    // Funci贸n para mostrar facturas radicadas en la tabla
    function mostrarFacturasRadicadas(radicaciones) {
      const tbody = document.getElementById('facturas-act-body');
      tbody.innerHTML = '';
      
      if (radicaciones.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="14" style="text-align: center;">No se encontraron facturas radicadas con los criterios seleccionados</td>`;
        tbody.appendChild(row);
        return;
      }
      
      radicaciones.forEach(radicacion => {
        radicacion.facturas.forEach(facturaId => {
          const factura = facturas.find(f => f.id === facturaId);
          if (!factura) return;
          
          const row = document.createElement('tr');
          row.dataset.id = factura.id;
          row.dataset.radicacionId = radicacion.id;
          
          // Verificar semaforizaci贸n
          const semaforo = factura.soportes.every(soporte => soporte.semaforizacion === 'verde') ? 'verde' : 'rojo';
          
          row.innerHTML = `
            <td class="col-select"><input type="checkbox" onclick="toggleSelectFacturaActualizar(this)"></td>
            <td class="col-select"><span class="ver-detalle" onclick="mostrarDetalleFacturaActualizar(${factura.id})">+</span></td>
            <td>${radicacion.numRadicadoInt}</td>
            <td>${formatDate(radicacion.fechaHoraRadicacion)}</td>
            <td>${factura.nombreAseguradora}</td>
            <td>${factura.numCaso}</td>
            <td>${factura.numFactura}</td>
            <td>${factura.estFact}</td>
            <td>$${formatNumber(factura.vrFactura)}</td>
            <td><span class="ver-archivos" onclick="mostrarSoportes(${factura.id})">Ver</span></td>
            <td><div class="semaforo ${semaforo}"></div></td>
            <td>${radicacion.numRadicadoExt || ''}</td>
            <td>${radicacion.fechaHoraRadicacionExt ? formatDate(radicacion.fechaHoraRadicacionExt) : ''}</td>
            <td>${radicacion.usuarioModifica || ''}</td>
          `;
          
          tbody.appendChild(row);
        });
      });
    }
    
    // Funci贸n para mostrar el detalle de una factura en la pesta帽a Actualizar
    function mostrarDetalleFacturaActualizar(facturaId) {
      const factura = facturas.find(f => f.id == facturaId);
      if (!factura) return;
      
      const tbody = document.getElementById('detalle-factura-act').querySelector('tbody');
      tbody.innerHTML = '';
      
      factura.servicios.forEach(servicio => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${servicio.consServ}</td>
          <td>${servicio.codServFact}</td>
          <td>${servicio.descripServ}</td>
          <td>${servicio.cantServ}</td>
          <td>$${formatNumber(servicio.vrServ)}</td>
        `;
        tbody.appendChild(row);
      });
      
      document.getElementById('detalle-factura-act-container').classList.remove('hidden');
      
      // Resaltar la fila seleccionada
      const rows = document.querySelectorAll('#facturas-act-body tr');
      rows.forEach(row => {
        row.style.backgroundColor = row.dataset.id == facturaId ? '#f0e6ff' : '';
      });
    }
    
    // Funci贸n para seleccionar/deseleccionar todas las facturas en Actualizar
    function toggleSelectAllActualizar(checkbox) {
      const checkboxes = document.querySelectorAll('#facturas-act-body input[type="checkbox"]');
      checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
      });
      
      // Mostrar u ocultar secci贸n de actualizaci贸n
      document.getElementById('actualizar-radicado-container').classList.toggle('hidden', !checkbox.checked);
    }
    
    // Funci贸n para seleccionar/deseleccionar una factura individual en Actualizar
    function toggleSelectFacturaActualizar(checkbox) {
      const checkAll = document.querySelector('#tabla-facturas-act thead input[type="checkbox"]');
      const checkboxes = document.querySelectorAll('#facturas-act-body input[type="checkbox"]');
      
      // Verificar si todos est谩n seleccionados
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkAll.checked = allChecked;
      
      // Mostrar u ocultar secci贸n de actualizaci贸n
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      document.getElementById('actualizar-radicado-container').classList.toggle('hidden', !anyChecked);
    }
    
    // Funci贸n para actualizar el n煤mero de radicaci贸n externo
    function actualizarRadicacion() {
      const numRadicadoExt = document.getElementById('num-radicado-ext').value;
      if (!numRadicadoExt) {
        showMessage('message-area-actualizar', 'Por favor ingrese un n煤mero de radicaci贸n externo', 'error');
        return;
      }
      
      const checkboxes = document.querySelectorAll('#facturas-act-body input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        showMessage('message-area-actualizar', 'Por favor seleccione al menos una factura para actualizar', 'error');
        return;
      }
      
      const fechaHoraActualizacion = new Date().toISOString();
      const usuarioModifica = 'UsuarioDemo'; // En una aplicaci贸n real ser铆a el usuario autenticado
      
      checkboxes.forEach(checkbox => {
        const row = checkbox.closest('tr');
        const radicacionId = parseInt(row.dataset.radicacionId);
        
        // Actualizar la radicaci贸n
        const radicacion = facturasRadicadas.find(r => r.id === radicacionId);
        if (radicacion) {
          radicacion.numRadicadoExt = numRadicadoExt;
          radicacion.fechaHoraRadicacionExt = fechaHoraActualizacion;
          radicacion.usuarioModifica = usuarioModifica;
        }
      });
      
      // Actualizar localStorage
      localStorage.setItem('facturasRadicadas', JSON.stringify(facturasRadicadas));
      
      // Mostrar mensaje de 茅xito
      document.getElementById('modal-actualizacion').style.display = 'block';
      
      // Actualizar tabla
      buscarFacturasRadicadas();
    }
    
    // Funci贸n para buscar facturas radicadas (pesta帽a Consultar)
    function buscarFacturasRadicadasConsultar() {
      const numRadicadoExt = document.getElementById('num-radicado-ext-cons').value;
      const numFactura = document.getElementById('num-factura-cons').value;
      const estadoFactura = document.getElementById('estado-factura-cons').value;
      const fechaInicio = document.getElementById('fecha-inicio-cons').value;
      const fechaFin = document.getElementById('fecha-fin-cons').value;
      
      // Filtrar facturas radicadas seg煤n criterios
      let radicacionesFiltradas = facturasRadicadas.filter(radicacion => {
        // Filtrar por n煤mero de radicado externo
        if (numRadicadoExt && radicacion.numRadicadoExt !== numRadicadoExt) {
          return false;
        }
        
        // Filtrar por fecha
        if (fechaInicio && new Date(radicacion.fechaHoraRadicacion) < new Date(fechaInicio)) {
          return false;
        }
        
        if (fechaFin && new Date(radicacion.fechaHoraRadicacion) > new Date(fechaFin)) {
          return false;
        }
        
        // Verificar que las facturas asociadas coincidan con el n煤mero de factura si se especific贸
        if (numFactura) {
          const facturasAsociadas = radicacion.facturas.map(id => 
            facturas.find(f => f.id === id && f.numFactura.includes(numFactura))
          ).filter(Boolean);
          
          return facturasAsociadas.length > 0;
        }
        
        return true;
      });
      
      // Mostrar radicaciones en la tabla
      mostrarFacturasConsultar(radicacionesFiltradas);
    }
    
    // Funci贸n para mostrar facturas radicadas en la pesta帽a Consultar
    function mostrarFacturasConsultar(radicaciones) {
      const tbody = document.getElementById('facturas-cons-body');
      tbody.innerHTML = '';
      
      if (radicaciones.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="15" style="text-align: center;">No se encontraron facturas radicadas con los criterios seleccionados</td>`;
        tbody.appendChild(row);
        return;
      }
      
      // Agrupar facturas por radicaci贸n para mostrar
      const facturasMostrar = [];
      
      radicaciones.forEach(radicacion => {
        radicacion.facturas.forEach(facturaId => {
          const factura = facturas.find(f => f.id === facturaId);
          if (!factura) return;
          
          facturasMostrar.push({
            ...factura,
            radicacion: radicacion
          });
        });
      });
      
      facturasMostrar.forEach(factura => {
        const row = document.createElement('tr');
        row.dataset.id = factura.id;
        
        // Verificar semaforizaci贸n
        const semaforo = factura.soportes.every(soporte => soporte.semaforizacion === 'verde') ? 'verde' : 'rojo';
        
        row.innerHTML = `
          <td class="col-select"><input type="checkbox" onclick="toggleSelectFacturaConsultar(this)"></td>
          <td class="col-select"><span class="ver-detalle" onclick="mostrarDetalleFacturaConsultar(${factura.id})">+</span></td>
          <td>${factura.numCaso}</td>
          <td>${factura.numFactura}</td>
          <td>${factura.estFact}</td>
          <td>${factura.nombreAseguradora}</td>
          <td>$${formatNumber(factura.vrFactura)}</td>
          <td>${factura.radicacion.numRadicadoInt}</td>
          <td>${formatDate(factura.radicacion.fechaHoraRadicacion)}</td>
          <td>${factura.radicacion.usuarioRadica}</td>
          <td>${factura.radicacion.numRadicadoExt || ''}</td>
          <td>${factura.radicacion.fechaHoraRadicacionExt ? formatDate(factura.radicacion.fechaHoraRadicacionExt) : ''}</td>
          <td>${factura.radicacion.usuarioModifica || ''}</td>
          <td><span class="ver-archivos" onclick="mostrarSoportes(${factura.id})">Ver</span></td>
          <td><div class="semaforo ${semaforo}"></div></td>
        `;
        
        tbody.appendChild(row);
      });
      
      // Mostrar u ocultar bot贸n de relaci贸n
      const anyChecked = document.querySelectorAll('#facturas-cons-body input[type="checkbox"]:checked').length > 0;
      document.getElementById('btn-relacion-cons').classList.toggle('hidden', !anyChecked);
    }
    
    // Funci贸n para mostrar el detalle de una factura en la pesta帽a Consultar
    function mostrarDetalleFacturaConsultar(facturaId) {
      const factura = facturas.find(f => f.id == facturaId);
      if (!factura) return;
      
      const tbody = document.getElementById('detalle-factura-cons').querySelector('tbody');
      tbody.innerHTML = '';
      
      factura.servicios.forEach(servicio => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${servicio.consServ}</td>
          <td>${servicio.codServFact}</td>
          <td>${servicio.descripServ}</td>
          <td>${servicio.cantServ}</td>
          <td>$${formatNumber(servicio.vrServ)}</td>
        `;
        tbody.appendChild(row);
      });
      
      document.getElementById('detalle-factura-cons-container').classList.remove('hidden');
      
      // Resaltar la fila seleccionada
      const rows = document.querySelectorAll('#facturas-cons-body tr');
      rows.forEach(row => {
        row.style.backgroundColor = row.dataset.id == facturaId ? '#f0e6ff' : '';
      });
    }
    
    // Funci贸n para seleccionar/deseleccionar todas las facturas en Consultar
    function toggleSelectAllConsultar(checkbox) {
      const checkboxes = document.querySelectorAll('#facturas-cons-body input[type="checkbox"]');
      checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
      });
      
      // Mostrar u ocultar bot贸n de relaci贸n
      document.getElementById('btn-relacion-cons').classList.toggle('hidden', !checkbox.checked);
    }
    
    // Funci贸n para seleccionar/deseleccionar una factura individual en Consultar
    function toggleSelectFacturaConsultar(checkbox) {
      const checkAll = document.querySelector('#tabla-facturas-cons thead input[type="checkbox"]');
      const checkboxes = document.querySelectorAll('#facturas-cons-body input[type="checkbox"]');
      
      // Verificar si todos est谩n seleccionados
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkAll.checked = allChecked;
      
      // Mostrar u ocultar bot贸n de relaci贸n
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      document.getElementById('btn-relacion-cons').classList.toggle('hidden', !anyChecked);
    }
    
    // Funci贸n para generar la relaci贸n de radicaci贸n en la pesta帽a Consultar
    function generarRelacionRadicacionConsultar() {
      // Similar a la funci贸n generarRelacionRadicacion, pero para facturas seleccionadas en Consultar
      generarRelacionRadicacion();
    }
    
    // Funci贸n para descargar el PDF (simulaci贸n)
    function descargarPDF() {
      alert('En una implementaci贸n real, esto descargar铆a el PDF de relaci贸n de facturas radicadas');
    }
    
    // Funci贸n para imprimir el PDF (simulaci贸n)
    function imprimirPDF() {
      alert('En una implementaci贸n real, esto abrir铆a el di谩logo de impresi贸n para el PDF');
    }
    
    // Funci贸n para cerrar un modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    // Funci贸n para mostrar un mensaje
    function showMessage(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="message ${type}">${message}</div>`;
      
      // Eliminar el mensaje despu茅s de 5 segundos
      setTimeout(() => {
        element.innerHTML = '';
      }, 5000);
    }
    
    // Funci贸n para formatear una fecha
    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleDateString('es-CO');
    }
    
    // Funci贸n para formatear una hora
    function formatTime(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }
    
    // Funci贸n para formatear un n煤mero como moneda
    function formatNumber(number) {
      return new Intl.NumberFormat('es-CO').format(number);
    }
    
    // Funci贸n auxiliar para obtener una aseguradora por ID
    function obtenerAseguradoraPorId(id) {
      const aseguradoras = [
        { id: 1, nombre: 'EPS Sanitas', nit: '8000152350' },
        { id: 2, nombre: 'EPS Sura', nit: '8000152351' },
        { id: 3, nombre: 'EPS Coomeva', nit: '8000152352' }
      ];
      return aseguradoras.find(a => a.id == id);
    }
  </script>
</body>
</html>