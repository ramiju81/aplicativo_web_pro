<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Medical Fees mySiss</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --mysiss-purple: #800080;
            --mysiss-light-purple: #EBE3F2;
            --mysiss-hover-purple: #DFD1EE;
            --mysiss-active-bg: #D0B8E6;
        }
        .custom-radio {
            accent-color: var(--mysiss-purple);
        }
        .focus-outline:focus-visible {
            outline: 2px solid var(--mysiss-purple);
            outline-offset: 2px;
        }
        /* Estilos para el sidebar */
        .submenu {
            display: none;
            padding-left: 1rem;
        }
        .submenu.active {
            display: block;
        }
        .nav-link.active {
            background-color: var(--mysiss-active-bg);
            font-weight: bold;
            position: relative;
        }
        .nav-link.active::after {
            content: "";
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: var(--mysiss-purple);
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        /* Estilo para el contenedor del menú */
        nav {
            display: flex;
            flex-direction: column;
            height: calc(100% - 80px);
            position: relative;
        }
        /* Estilo para el enlace de cerrar sesión */
        .logout-link {
            margin-top: auto;
            position: sticky;
            bottom: 0;
            background-color: var(--mysiss-light-purple);
            padding-top: 10px;
            padding-bottom: 10px;
        }
        .table-row-inactive {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .selected-row {
            background-color: #DFD1EE;
        }
    </style>
</head>
<body class="flex h-screen w-full overflow-hidden">
    <!-- Sidebar -->
    <div class="w-48 h-full bg-[var(--mysiss-light-purple)] flex flex-col">
        <div class="p-6">
            <h1 class="text-[var(--mysiss-purple)] text-5xl font-bold">mySiss</h1>
        </div>
        <nav class="mt-4 flex flex-col" aria-label="Menú principal">
            <!-- Configuración -->
            <div class="menu-item">
                <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('config-submenu', this)">
                    <strong>Configuración</strong>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </a>
                <div id="config-submenu" class="submenu">
                    <a href="conf_bas_1.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Base</a>
                    <a href="conf_func_1.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Funcionalidad</a>
                    <a href="conf_role.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Roles</a>
                </div>
            </div>
            
            <!-- Usuario -->
            <div class="menu-item">
                <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('usuario-submenu', this)">
                    <strong>Usuario</strong>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </a>
                <div id="usuario-submenu" class="submenu">
                    <a href="conf_usua_1.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Creación user</a>
                    <a href="conf_rol.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">User rol</a>
                </div>
            </div>
                        
            <!-- Módulos - Estructura de tres niveles -->
            <div class="menu-item">
                <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('modulos-submenu', this)">
                    <strong>Modulos</strong>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </a>
                <div id="modulos-submenu" class="submenu">
                    <!-- Honorarios -->
                    <div class="menu-item">
                        <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('honorarios-submenu', this)">
                            <span>Honorarios</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </a>
                        <div id="honorarios-submenu" class="submenu">
                            <a href="../Honorarios/configuracion.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Configuración</a>
                            <a href="../Honorarios/Honorarios.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Proceso</a>
                        </div>
                    </div>
                    
                    <!-- Auditoria -->
                    <div class="menu-item">
                        <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('auditoria-submenu', this)">
                            <span>Auditoria</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </a>
                        <div id="auditoria-submenu" class="submenu">
                            <a href="../auditoria/configuracion.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Configuración</a>
                            <a href="../auditoria/auditoria.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Proceso</a>
                        </div>
                    </div>
                    
                    <!-- Glosas -->
                    <div class="menu-item">
                        <a href="#" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline flex justify-between items-center" onclick="toggleSubmenu('glosas-submenu', this)">
                            <span>Glosas</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </a>
                        <div id="glosas-submenu" class="submenu">
                            <a href="../glosas/configuracion.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Configuración</a>
                            <a href="../glosas/glosas.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors focus-outline block">Proceso</a>
                        </div>
                    </div>
                </div>
            </div>
            <a href="../login.html" class="nav-link py-2 px-6 text-[var(--mysiss-purple)] hover:bg-[var(--mysiss-hover-purple)] transition-colors mt-44 focus-outline">
                <strong>Cerrar Sesión</strong>
            </a>
        </nav>
    </div>

    <!-- Contenido principal -->
    <div class="flex-1 bg-white p-8 overflow-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-[var(--mysiss-purple)]">Roles</h2>
            <button id="saveAllBtn" class="px-4 py-2 bg-[var(--mysiss-purple)] text-white rounded-md focus-outline">
                Guardar
            </button>
        </div>

        <!-- Pestañas modificadas -->
        <div class="mb-8 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px" id="tabs" role="tablist">
                <li role="presentation">
                    <button class="inline-block p-4 border-b-2 border-[var(--mysiss-purple)] text-[var(--mysiss-purple)] rounded-t-lg" id="usuarios-tab" type="button" role="tab">Roles-Usuario</button>
                </li>
            </ul>
        </div>

        <!-- Contenido de pestañas modificado -->
        <div id="tab-content">
            <!-- Pestaña Roles-Usuario siempre visible -->
            <div class="p-4 rounded-lg bg-gray-50" id="usuarios" role="tabpanel">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Módulo</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Funcionalidad</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actividad</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="userRolesTableBody">
                            <!-- Filas se generan dinámicamente -->
                        </tbody>
                    </table>
                    
                    <div class="mt-4">
                        <button id="addUserRoleBtn" class="px-4 py-2 bg-[var(--mysiss-purple)] text-white rounded-md focus-outline">
                            Agregar Asociación
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal para mensajes -->
    <div id="messageModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg max-w-md w-full">
            <h3 id="modalTitle" class="text-lg font-bold mb-4"></h3>
            <p id="modalMessage" class="mb-4"></p>
            <div class="flex justify-end">
                <button id="modalCloseBtn" class="px-4 py-2 bg-[var(--mysiss-purple)] text-white rounded-md focus-outline">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para búsqueda -->
    <div id="searchModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg max-w-2xl w-full">
            <h3 id="searchModalTitle" class="text-lg font-bold mb-4"></h3>
            <div class="mb-4">
                <input type="text" id="searchInput" class="border border-gray-300 rounded-md px-3 py-2 w-full focus-outline" placeholder="Buscar...">
            </div>
            <div class="max-h-96 overflow-y-auto mb-4">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seleccionar</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="searchResults">
                        <!-- Resultados de búsqueda -->
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end">
                <button id="searchModalCloseBtn" class="px-4 py-2 bg-[var(--mysiss-purple)] text-white rounded-md focus-outline">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para búsqueda de usuarios -->
    <div id="userSearchModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg max-w-4xl w-full">
            <h3 id="userSearchModalTitle" class="text-lg font-bold mb-4">Buscar Usuario</h3>
            <div class="mb-4">
                <input type="text" id="userSearchInput" class="border border-gray-300 rounded-md px-3 py-2 w-full focus-outline" placeholder="Buscar por nombre, apellido o cédula...">
            </div>
            <div class="max-h-96 overflow-y-auto mb-4">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Apellido</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cédula</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cargo</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Celular</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seleccionar</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="userSearchResults">
                        <!-- Resultados de búsqueda de usuarios -->
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end">
                <button id="userSearchModalCloseBtn" class="px-4 py-2 bg-[var(--mysiss-purple)] text-white rounded-md focus-outline">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

<script>
    // Datos y configuraciones iniciales
    const config = {
        rolesData: JSON.parse(localStorage.getItem('rolesData')) || [
            {
                rol: 'Administrativo',
                modulo: 'Honorarios',
                funcionalidad: 'Preliquidación',
                actividad: 'Filtrar preliquidación',
                crear: true,
                modificar: true,
                visualizar: true,
                eliminar: true
            }
        ],
        userRolesData: JSON.parse(localStorage.getItem('userRolesData')) || [],
        modulosData: [
            { codigo: 'MH001', nombre: 'Honorarios' },
            { codigo: 'MG001', nombre: 'Glosas' }
        ],
        currentRow: null,
        selectedUserRoleRow: null
    };

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        initApplication();
    });

    function initApplication() {
        renderUserRolesTable();
        setupMainEventListeners();
        setupMenuNavigation();
        setActiveMenu();
    }

    // Configuración del menú lateral - MODIFICADO PARA MANTENER TODO ABIERTO
    function setupMenuNavigation() {
        // Abrir todos los submenús al cargar
        document.querySelectorAll('.submenu').forEach(menu => {
            menu.classList.add('active');
        });
        
        // Rotar todas las flechas hacia abajo
        document.querySelectorAll('.menu-item > a.nav-link svg').forEach(icon => {
            icon.classList.add('rotate-180');
        });
        
        // Eliminar eventos de clic que abren/cierran menús
        const menuItems = document.querySelectorAll('.menu-item > a.nav-link');
        menuItems.forEach(item => {
            item.removeEventListener('click', toggleSubmenu);
        });
    }

    // Funcionalidad principal de la página
    function setupMainEventListeners() {
        // Botón Agregar Asociación
        document.getElementById('addUserRoleBtn').addEventListener('click', function() {
            const tableBody = document.getElementById('userRolesTableBody');
            const newRow = document.createElement('tr');
            newRow.className = 'table-row-active';
            newRow.dataset.id = 'new';
            
            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex">
                        <input type="text" class="search-user-input border rounded-l-md px-2 py-1 w-full" readonly>
                        <button class="search-user-btn px-2 py-1 bg-[var(--mysiss-purple)] text-white rounded-r-md">
                            ...
                        </button>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex">
                        <input type="text" class="search-role-input border rounded-l-md px-2 py-1 w-full" readonly>
                        <button class="search-role-btn px-2 py-1 bg-[var(--mysiss-purple)] text-white rounded-r-md">
                            ...
                        </button>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <input type="text" class="modulo-input border rounded-md px-2 py-1 w-full" readonly>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <input type="text" class="funcionalidad-input border rounded-md px-2 py-1 w-full" readonly>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <input type="text" class="actividad-input border rounded-md px-2 py-1 w-full" readonly>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <button class="save-user-role-btn px-2 py-1 bg-green-500 text-white rounded-md">
                        Guardar
                    </button>
                </td>
            `;
            
            tableBody.prepend(newRow);
            
            // Configurar eventos para la nueva fila
            setupNewRowEvents(newRow);
        });
        
        // Botón Guardar
        document.getElementById('saveAllBtn').addEventListener('click', function() {
            localStorage.setItem('userRolesData', JSON.stringify(config.userRolesData));
            showMessage('Éxito', 'Todos los cambios han sido guardados');
        });
    }

    function setupNewRowEvents(row) {
        row.querySelector('.search-user-btn').addEventListener('click', function() {
            config.currentRow = row;
            showUserSearchModal();
        });
        
        row.querySelector('.search-role-btn').addEventListener('click', function() {
            config.currentRow = row;
            showSearchModal('Buscar Rol', config.rolesData.map(r => ({ codigo: r.rol, nombre: r.rol })));
        });
        
        row.querySelector('.save-user-role-btn').addEventListener('click', function() {
            const inputs = row.querySelectorAll('input[type="text"]');
            const newUserRole = {
                usuario: inputs[0].value,
                rol: inputs[1].value,
                modulo: inputs[2].value,
                funcionalidad: inputs[3].value,
                actividad: inputs[4].value
            };
            
            if (!newUserRole.usuario || !newUserRole.rol) {
                showMessage('Error', 'Usuario y Rol son obligatorios');
                return;
            }
            
            config.userRolesData.unshift(newUserRole);
            localStorage.setItem('userRolesData', JSON.stringify(config.userRolesData));
            renderUserRolesTable();
            showMessage('Éxito', 'Asociación agregada correctamente');
        });
    }

    function renderUserRolesTable() {
        const tableBody = document.getElementById('userRolesTableBody');
        tableBody.innerHTML = '';
        
        config.userRolesData.forEach((item, index) => {
            const row = document.createElement('tr');
            row.className = 'table-row-inactive';
            row.dataset.id = index;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">${item.usuario}</td>
                <td class="px-6 py-4 whitespace-nowrap">${item.rol}</td>
                <td class="px-6 py-4 whitespace-nowrap">${item.modulo}</td>
                <td class="px-6 py-4 whitespace-nowrap">${item.funcionalidad}</td>
                <td class="px-6 py-4 whitespace-nowrap">${item.actividad}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <button class="delete-user-role-btn px-2 py-1 bg-red-500 text-white rounded-md">
                        Eliminar
                    </button>
                </td>
            `;
            
            row.addEventListener('click', function() {
                document.querySelectorAll('#userRolesTableBody tr').forEach(r => {
                    r.classList.remove('selected-row');
                });
                this.classList.add('selected-row');
                config.selectedUserRoleRow = index;
            });
            
            row.querySelector('.delete-user-role-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                if (confirm('¿Eliminar esta asociación?')) {
                    config.userRolesData.splice(index, 1);
                    localStorage.setItem('userRolesData', JSON.stringify(config.userRolesData));
                    renderUserRolesTable();
                    showMessage('Éxito', 'Asociación eliminada');
                }
            });
            
            tableBody.appendChild(row);
        });
    }

    // Funciones auxiliares
    function showSearchModal(title, items) {
        const modal = document.getElementById('searchModal');
        const results = document.getElementById('searchResults');
        
        document.getElementById('searchModalTitle').textContent = title;
        results.innerHTML = '';
        
        items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4">${item.codigo}</td>
                <td class="px-6 py-4">${item.nombre}</td>
                <td class="px-6 py-4">
                    <button class="select-item-btn px-2 py-1 bg-[var(--mysiss-purple)] text-white rounded-md">
                        Seleccionar
                    </button>
                </td>
            `;
            
            row.querySelector('.select-item-btn').addEventListener('click', function() {
                if (config.currentRow) {
                    config.currentRow.querySelector('.search-role-input').value = item.nombre;
                    const rol = config.rolesData.find(r => r.rol === item.nombre);
                    if (rol) {
                        config.currentRow.querySelector('.modulo-input').value = rol.modulo;
                        config.currentRow.querySelector('.funcionalidad-input').value = rol.funcionalidad;
                        config.currentRow.querySelector('.actividad-input').value = rol.actividad;
                    }
                }
                modal.classList.add('hidden');
            });
            
            results.appendChild(row);
        });
        
        document.getElementById('searchInput').value = '';
        modal.classList.remove('hidden');
    }

    function showUserSearchModal() {
        const modal = document.getElementById('userSearchModal');
        const results = document.getElementById('userSearchResults');
        results.innerHTML = '';
        
        usuariosData.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4">${user.usuario}</td>
                <td class="px-6 py-4">${user.nombre}</td>
                <td class="px-6 py-4">${user.apellido}</td>
                <td class="px-6 py-4">${user.cedula}</td>
                <td class="px-6 py-4">${user.cargo}</td>
                <td class="px-6 py-4">${user.celular}</td>
                <td class="px-6 py-4">
                    <button class="select-user-btn px-2 py-1 bg-[var(--mysiss-purple)] text-white rounded-md">
                        Seleccionar
                    </button>
                </td>
            `;
            
            row.querySelector('.select-user-btn').addEventListener('click', function() {
                if (config.currentRow) {
                    config.currentRow.querySelector('.search-user-input').value = user.usuario;
                }
                modal.classList.add('hidden');
            });
            
            results.appendChild(row);
        });
        
        modal.classList.remove('hidden');
    }

    function showMessage(title, message) {
        const modal = document.getElementById('messageModal');
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        modal.classList.remove('hidden');
    }

    function setActiveMenu() {
        const currentPath = window.location.pathname.split('/').pop() || 'conf_rol.html';
        
        document.querySelectorAll('.nav-link[href]').forEach(link => {
            const linkPath = link.getAttribute('href').split('/').pop();
            
            if (linkPath === currentPath) {
                link.classList.add('active');
            }
        });
    }

    // Filtrado de búsqueda
    document.getElementById('searchInput')?.addEventListener('input', function() {
        const term = this.value.toLowerCase();
        document.querySelectorAll('#searchResults tr').forEach(row => {
            row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
        });
    });

    document.getElementById('userSearchInput')?.addEventListener('input', function() {
        const term = this.value.toLowerCase();
        document.querySelectorAll('#userSearchResults tr').forEach(row => {
            row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
        });
    });

    // Cerrar modales
    document.querySelectorAll('[data-modal-close]').forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById(this.dataset.modalClose).classList.add('hidden');
        });
    });

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) this.classList.add('hidden');
        });
    });
</script>
</body>
</html>